---
title: "Schließende Statistik"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("Skripte/import.R")
source("Skripte/subsets_erstellen.R")
source("Skripte/all_tpt.R")
source("Skripte/util.R")

library(car)
library(multcomp)
library(rstatix)
library(ggpubr)
library(datarium)
library(emmeans)
library(tidyverse)
library(stats)
library(ggplot2)
library(knitr)
library(dplyr)
```

# Nullhypothese:
H<sub>0</sub>: Die Färbung der Buttons und die Beschriftung haben keine Auswirkung auf die Bearbeitungszeit

# Gegenhypothese:
H<sub>1</sub>: Die Färbung der Buttons und die Beschriftung haben Auswirkung auf die Bearbeitungszeit

# Mittelwert und Standardabweichung
```{r}

agg1 <- data_time_config_long %>%
  group_by(Reaction) %>%
  summarize(Mittelwerte = mean(data_time_config_long$`Time in ms`),
            Standardabweichungen=sd(data_time_config_long$`Time in ms`),
            .groups="keep")

agg1
```
treatment = Reaction
response = Time in MS
```{r}
install.packages('gplots')
library(gplots)
plotmeans(data_time_config_long$`Time in ms` ~ data_time_config_long$Reaction, data=data_time_config_long,
          xlab="Konfigurationen",
          ylab="Zeit in Millisekunden",
          col="darkgoldenrod2",
          n.label=FALSE,
          use.t=TRUE,
          barwidth=2,
          barcol="darkgoldenrod1",
          main='Konfiguration\n95% Konfidenzintervalle')
```

Wir erkennen das die Konfigurationen 4, 5 und 7 am schnellsten bearbeitet werden konnten 
# Varianzanalyse

## Streuung der Mittelwerte
```{r}
n1 <- 2387
n2 <- 2406
n3 <- 2422
n4 <- 137
n5 <- 115
n7 <- 76
n8 <- 2457

n <- n1+n2+n3+n4+n5+n7+n8
  
ybar<- 0.5*(agg1$Mittelwerte[1] 
            + agg1$Mittelwerte[2]
            + agg1$Mittelwerte[3]
            + agg1$Mittelwerte[5]
            + agg1$Mittelwerte[6]
            + agg1$Mittelwerte[7]
            )
sst <- n1*(agg1$Mittelwerte[1]-ybar)**2 
      + n2*(agg1$Mittelwerte[2]-ybar)**2 
      + n3*(agg1$Mittelwerte[3]-ybar)**2 
      + n4*(agg1$Mittelwerte[4]-ybar)**2
      + n5*(agg1$Mittelwerte[5]-ybar)**2 
      + n7*(agg1$Mittelwerte[6]-ybar)**2 
      + n8*(agg1$Mittelwerte[7]-ybar)**2
ybar
sst
```
## Streuung innerhalb der Gruppe

```{r}
sse1 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "1"]
sse1 <- sse1 - agg1$Mittelwerte[1]
sse1Sum <- sum(sse1**2)

sse2 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "2"]
sse2 <- sse2 - agg1$Mittelwerte[2]
sse2Sum <- sum(sse2**2)

sse3 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "3"]
sse3 <- sse3 - agg1$Mittelwerte[3]
sse3Sum <- sum(sse3**2)


sse4 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "4"]
sse4 <- sse4 - agg1$Mittelwerte[4]
sse4Sum <- sum(sse4**2)


sse5 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "5"]
sse5 <- sse5 - agg1$Mittelwerte[5]
sse5Sum <- sum(sse5**2)


sse7 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "7"]
sse7 <- sse7 - agg1$Mittelwerte[6]
sse7Sum <- sum(sse7**2)


sse8 <- data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "8"]
sse8 <- sse8 - agg1$Mittelwerte[7]
sse8Sum <- sum(sse8**2)

sse <- sse1Sum+sse2Sum+sse3Sum+sse4Sum+sse5Sum+sse7Sum+sse8Sum
sse
```

## MST mean sqaure for treatments
```{r}
p <- 7

mst <- sst/(p-1)
mst

```
## MSE mean square for error
```{r}


mse <- sse/(n-p)
mse
```
## F 
```{r}
f <- mst/mse
f
```

## F-Quant
```{r}
fquant <- qf(0.95, (p-1), (n-p))
fquant
```

Wir verwerfen die Nullhypothese nicht ?

## Anova-Test
```{r}

anova1 <- aov(data_time_config_long$`Time in ms` ~ data_time_config_long$Reaction)
summary(anova1)
```

## Paarweise Vergleiche
```{r}
tukey <- TukeyHSD(anova1)

```

```{r}
#par(las=2)
#par(mar=c(5,8,2,4))
plot(tukey,
     las=1,
     col="darkgoldenrod1")


```

```{r}
#library(multcomp)
#par(mar=c(5, 4, 6, 2))
#tukey1 <- glht(anova1, linfct=mcp(data_time_config_long$Reaction="Tukey"))
#plot(cld(tukey1, level=0.05), col="darkgoldenrod1")
```

```{r}
library(ggplot2)
pwc <- data_time_config_long %>% 
  tukey_hsd(data_time_config_long$`Time in ms` ~ data_time_config_long$Reaction)

pwc
```

```{r}
#pwc <- pwc %>% 
#  add_xy_position(x = "data_time_config_long$Reaction")

#ggplot(data=data_time_config_long$Reaction, aes(x=data_time_config_long$Reaction, y = data_time_config_long$`Time in ms`)) + 
#  geom_boxplot(fill="darkgoldenrod1", color="black") + 
#  stat_pvalue_manual(pwc, hide.ns=FALSE) + 
#  labs(
#    title="Paarweise Vergleiche nach Tukey für den Datensatz Data_time_config_long"
#  )
```

## Überprüfung der Voraussetzungen
In der Annahme für die Verwendung der Funktion aov steckt insbesondere, dass die untersuchte Größe normalverteilt ist und die Varianzen in den Faktoren gleich sind. Das können wir mit Hilfe eines Q-Q Plots überprüfen.
```{r}
model <- lm(data_time_config_long$`Time in ms` ~ data_time_config_long$Reaction, data =data_time_config_long)
ggqqplot(residuals(model), title="Q-Q Plot für den Datensatz Konfiguration (95% Konfidenzniveau)", xlab="Theoretisch", ylab = "Residuen", panel.labs = TRUE)
```

```{r}

shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "1"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "2"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "3"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "4"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "5"])
#shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "6"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "7"])
shapiro.test(data_time_config_long$`Time in ms`[data_time_config_long$Reaction == "8"])

```